Voici une version ultra-d√©taill√©e et approfondie du prompt, en insistant sur l‚ÄôUI/UX (en noir et blanc strict, sans violet), l‚Äôarchitecture technique, et les aspects fonctionnels. Ce prompt est structur√© pour que l‚ÄôIA (Jules ou autre) puisse g√©n√©rer un code optimis√©, modulaire et pr√™t pour la mon√©tisation, tout en respectant tes contraintes (Kotlin, pas d‚Äôacc√®s aux variables d‚Äôenvironnement, th√®me sombre noir et blanc).

Contexte et Vision du Projet Nom de l‚ÄôApplication "SwipeClean" ‚Äì Une application de tri de photos/vid√©os par swipe, con√ßue pour lib√©rer de l‚Äôespace de stockage de mani√®re intuitive et visuelle. Philosophie Design
Minimalisme radical : UI √©pur√©e, uniquement en noir et blanc (pas de couleurs, pas de violet). Exp√©rience tactile : Tout est bas√© sur des gestes (swipe) pour une interaction fluide et naturelle. Feedback visuel clair : Animations subtiles pour confirmer les actions (ex: fondu lors de la suppression).

Public Cible

Utilisateurs soucieux de l‚Äôorganisation de leur galerie mais qui n‚Äôont pas le temps de trier manuellement. Personnes aimant les interfaces simples, sans distraction. Cible secondaire : Photographes amateurs qui veulent classer leurs m√©dias rapidement.

Sp√©cifications UI/UX (Noir et Blanc Strict) A. Palette de Couleurs √âl√©mentCouleur HexUsageFond#000000Arri√®re-plan de tous les √©crans.Texte principal#FFFFFFTitre, boutons, descriptions.Texte secondaire#808080Sous-titres, infos mineures.Bordures#333333S√©paration des sections.Overlay#000000 + 70% opacit√©Menus contextuels.Accent (boutons)#FFFFFF + bordure #333333Boutons "Commencer", "Annuler". B. Typographie
Police principale : Roboto (int√©gr√©e par d√©faut dans Flutter).

Taille des titres : 24px (bold). Taille du texte : 16px (regular). Sous-titres : 14px (#808080).

Espacement :

Marges : 16px entre les sections. Padding : 12px pour les boutons/cartes.

C. Composants UI Cl√©s

Barres de Stockage (√âcran d‚ÄôAccueil)
Design :

Deux barres horizontales superpos√©es verticalement. Barre 1 : Espace total vs utilis√© (ex: "64 Go / 45 Go utilis√©s").

Fond : #333333. Partie utilis√©e : #FFFFFF. Texte : #000000 (pour le contraste).

Barre 2 : Espace lib√©r√© ce mois-ci (ex: "+2,3 Go").

Fond : #333333. Partie lib√©r√©e : #808080.

Comportement :

Les barres se mettent √† jour en temps r√©el apr√®s chaque action de tri.

Cartes d‚ÄôAlbums (√âcran Albums)
Design :

Carte carr√©e (150x150px) avec :

Miniature : Derni√®re photo de l‚Äôalbum (recadr√©e en carr√©, filtre noir et blanc si couleur). Nom de l‚Äôalbum : Texte centr√© en bas (#FFFFFF, 16px). Bordure : 1px #333333.

Effet au double-clic : Le nom devient √©ditable (champ TextField avec bordure #808080).

Albums par d√©faut :

"Favoris" (ic√¥ne ‚ô• en #FFFFFF). "Voyages" (ic√¥ne avion en #FFFFFF). "Famille" (ic√¥ne maison en #FFFFFF).

Bouton "+" :

Gris√© (#333333), avec un tooltip : "Disponible en version Premium".

√âcran de Swipe
Design :

M√©dia : Occupe 90% de l‚Äô√©cran (hauteur et largeur), centr√©.

Photos : Affich√©es en noir et blanc (filtre appliqu√© dynamiquement). Vid√©os : Miniature en noir et blanc + ic√¥ne lecture (‚ñ∂ en #FFFFFF).

Barre de progression :

En haut : "X Mo lib√©r√©s" (#808080, 14px). Fond : #333333, barre de progression : #FFFFFF.

Indicateurs de geste :

Fl√®ches discr√®tes en transparence (20% d‚Äôopacit√©) :

‚Üê (supprimer), ‚Üí (conserver), ‚Üë (annuler), ‚Üì (albums).

Animations :

Swipe droit/gauche : Le m√©dia "glisse" hors de l‚Äô√©cran avec un effet de fondu. Swipe haut/bas : Menu contextuel appara√Æt en 0.3s (animation SlideTransition).

Menu des Albums (swipe bas) :

3 options (m√™mes ic√¥nes que les albums). Fond : #000000 + 90% opacit√©. Texte : #FFFFFF.

Navigation entre √âcrans
Swipe lat√©ral :

Utiliser PageView avec PageController pour un effet de "glisse" naturel. D√©sactiver le swipe lat√©ral sur l‚Äô√©cran de swipe (pour √©viter les conflits).

Boutons de navigation :

Fl√®ches en haut √† gauche/droite (ic√¥nes #FFFFFF, 24px). Barre de t√¢ches en bas (optionnelle) :

3 ic√¥nes : Accueil (‚ñ°), Swipe (‚Üî), Albums (‚óè).

Sp√©cifications Fonctionnelles Approfondies A. √âcran d‚ÄôAccueil (home_screen.dart)
Statistiques de Stockage
Donn√©es :

Utiliser path_provider pour r√©cup√©rer :

Espace total du t√©l√©phone. Espace utilis√©. Espace lib√©r√© depuis l‚Äôouverture de l‚Äôapp (stock√© en m√©moire via SharedPreferences).

Mise √† jour :

Rafra√Æchir les donn√©es √† chaque retour sur l‚Äô√©cran d‚Äôaccueil.

Dernier Album Visit√©
Logique :

R√©cup√©rer le dernier album ouvert depuis la base de donn√©es (floor). Afficher sa miniature et son nom. Cliquable ‚Üí redirige vers albums_screen.dart (avec l‚Äôalbum pr√©-s√©lectionn√©).

Boutons
"Commencer le tri" :

Bouton plein √©cran (hauteur : 60px, fond #FFFFFF, texte #000000). Redirige vers swipe_screen.dart.

"Voir les albums" :

Bouton secondaire (hauteur : 40px, bordure #333333, texte #808080). Redirige vers albums_screen.dart.

B. √âcran de Swipe (swipe_screen.dart)

Chargement des M√©dias
Source :

Utiliser photo_manager pour lister photos ET vid√©os. Filtres :

Exclure les dossiers syst√®me (ex: .thumb, WhatsApp). Trier par date (du plus r√©cent au plus ancien).

Optimisation :

Charger par lots de 20 m√©dias (pour √©viter la surcharge m√©moire). Cache des miniatures avec cached_network_image.

Gestes et Actions GesteActionFeedback VisuelSwipe droiteConserver le m√©dia (ne rien faire).Animation : m√©dia glisse √† droite + ‚úì vert (#808080).Swipe gaucheSupprimer le m√©dia (d√©placer vers .SwipeClean/Trash).Animation : m√©dia glisse √† gauche + ‚úó rouge (#808080).Swipe hautAnnuler la derni√®re action (restaurer le m√©dia pr√©c√©dent).Toast : "Action annul√©e" (#FFFFFF sur fond #333333).Swipe basOuvrir le menu des albums (3 options).Menu contextuel en overlay.Tap doubleBasculer entre photo originale et noir et blanc (optionnel).Animation de fondu.
Menu des Albums (Swipe Bas)
Design :

3 boutons horizontaux (m√™mes ic√¥nes que les albums). Fond : #000000 + 90% opacit√©. Texte : #FFFFFF.

Logique :

S√©lectionner un album ‚Üí le m√©dia est li√© √† l‚Äôalbum (pas de duplication de fichier). Fermeture du menu apr√®s s√©lection.

Barre de Progression
Calcul :

Somme des tailles des m√©dias supprim√©s depuis l‚Äôouverture de l‚Äôapp. Afficher en Mo ou Go (arrondi √† 1 d√©cimale).

R√©initialisation :

Remise √† z√©ro √† chaque fermeture de l‚Äôapp.

C. √âcran des Albums (albums_screen.dart)

Affichage des Albums
Grille :

GridView avec 2 colonnes (espacement : 16px). Chaque carte : 150x150px (voir section UI).

Donn√©es :

R√©cup√©rer les albums depuis la base floor. Pour chaque album :

Nom. Chemin de la derni√®re photo ajout√©e (pour la miniature).

√âdition du Nom
Double-clic sur le nom ‚Üí TextField appara√Æt. Validation :

Appuyer sur "Entr√©e" ou cliquer hors du champ pour sauvegarder.

Bouton "Commencer"
Logique :

Redirige vers un swipe_screen.dart sp√©cifique √† l‚Äôalbum :

Swipe gauche : Ajouter √† l‚Äôalbum. Swipe droite : Passer. Swipe haut : Annuler. Swipe bas : Choisir un autre album.

Architecture Technique A. Base de Donn√©es (Floor + Kotlin)
Tables Copier-- Table Albums CREATE TABLE albums ( id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT NOT NULL, cover_path TEXT, -- Chemin de la derni√®re photo ajout√©e is_premium BOOLEAN DEFAULT FALSE, created_at DATETIME DEFAULT CURRENT_TIMESTAMP );
-- Table Medias CREATE TABLE medias ( id INTEGER PRIMARY KEY AUTOINCREMENT, path TEXT NOT NULL UNIQUE, -- Chemin original du fichier type TEXT CHECK(type IN ('photo', 'video')), album_id INTEGER, deleted_at DATETIME, -- Null si non supprim√© FOREIGN KEY(album_id) REFERENCES albums(id) ); 2. Requ√™tes Cl√©s

R√©cup√©rer les albums : CopierSELECT * FROM albums WHERE is_premium = FALSE OR user_is_premium = TRUE;

M√©dias non tri√©s : CopierSELECT * FROM medias WHERE album_id IS NULL AND deleted_at IS NULL;

M√©dias d‚Äôun album : CopierSELECT * FROM medias WHERE album_id = :albumId;

B. Gestion des Fichiers

Suppression :

D√©placer les fichiers vers .SwipeClean/Trash/ (au lieu de supprimer d√©finitivement). Suppression d√©finitive apr√®s 30 jours (via un Worker en arri√®re-plan).

Restauration :

D√©placer le fichier depuis .SwipeClean/Trash/ vers son emplacement d‚Äôorigine.

C. Optimisations TypeTechniqueM√©moireLib√©rer les ressources apr√®s affichage d‚Äôun m√©dia (ex: dispose() pour les vid√©os).PerformancesChargement par lots + cache des miniatures.BatterieD√©sactiver la lecture auto des vid√©os si batterie < 20%.StockageCompresser les images > 5 Mo avant affichage.

Mon√©tisation (Pr√©paration) A. Flags Premium
Base de donn√©es :

Ajouter un champ user_is_premium (BOOL) dans une table users.

Fonctionnalit√©s bloqu√©es :

Bouton "+" pour ajouter un album ‚Üí gris√© + tooltip. Limite de 3 albums si user_is_premium = FALSE.

B. Int√©gration Future

√âcran "Premium" :

Accessible via un bouton en haut √† droite (ic√¥ne couronne). Contenu : Avantages (albums illimit√©s, cloud, etc.) + bouton "S‚Äôabonner".

Backend :

Pr√©voir une API pour v√©rifier l‚Äôabonnement (ex: Firebase).

Roadmap Post-MVP VersionFonctionnalit√©sPriorit√©1.1Sauvegarde cloud (Firebase Storage)Haute1.2Th√®mes personnalisables (noir/gris clair)Moyenne1.3Reconnaissance de visages (ML)Basse2.0Version iOS + Sync multi-appareilsHaute

Instructions pour l‚ÄôIA (Jules) A. Structure du Code Copierswipe_clean/ ‚îú‚îÄ‚îÄ lib/ ‚îÇ ‚îú‚îÄ‚îÄ main.dart # Th√®me sombre + routage ‚îÇ ‚îú‚îÄ‚îÄ screens/ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ home_screen.dart # √âcran d'accueil ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ swipe_screen.dart # √âcran de swipe (g√©n√©rique) ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ swipe_album_screen.dart # Swipe pour un album sp√©cifique ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ albums_screen.dart # √âcran des albums ‚îÇ ‚îú‚îÄ‚îÄ models/ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ album.dart # Mod√®le Album + DAO ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ media.dart # Mod√®le Media + DAO ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ database.dart # Configuration Floor ‚îÇ ‚îú‚îÄ‚îÄ widgets/ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ storage_bar.dart # Barres de stockage ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ album_card.dart # Carte d'album ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ media_card.dart # Carte de m√©dia (swipe) ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ swipe_menu.dart # Menu contextuel (swipe bas) ‚îÇ ‚îú‚îÄ‚îÄ utils/ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ constants.dart # Noms des albums, chemins, etc. ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ file_utils.dart # Gestion des fichiers (d√©placement, suppression) ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ theme.dart # Th√®me sombre noir et blanc ‚îÇ ‚îî‚îÄ‚îÄ app_router.dart # Gestion de la navigation ‚îú‚îÄ‚îÄ assets/ ‚îÇ ‚îî‚îÄ‚îÄ icons/ # Ic√¥nes en SVG/PNG (noir et blanc) ‚îî‚îÄ‚îÄ pubspec.yaml # D√©pendances (Kotlin uniquement) B. D√©pendances Flutter (Kotlin) Copierdependencies: flutter: sdk: flutter

Kotlin-compatible
path_provider: ^2.1.1 photo_manager: ^2.1.0 floor: ^1.4.0 video_thumbnail: ^0.5.0 cached_network_image: ^3.3.0 shared_preferences: ^2.2.0 flutter_swipe_action: ^2.0.0 C. √âtapes de D√©veloppement

Configurer le th√®me sombre (theme.dart) :

Couleurs : #000000, #FFFFFF, #333333, #808080. Polices : Roboto (bold/regular).

Impl√©menter la base de donn√©es (database.dart) :

Cr√©er les tables albums et medias avec floor. Ajouter des m√©thodes pour :

Lister les albums. Ajouter/supprimer un m√©dia. Restaurer un m√©dia.

Cr√©er les widgets r√©utilisables :

StorageBar : Barres de stockage (accueil). AlbumCard : Carte d‚Äôalbum (√©ditable). MediaCard : Carte de m√©dia avec gestes de swipe.

D√©velopper les √©crans :

home_screen.dart :

Barres de stockage (mises √† jour dynamiques). Boutons "Commencer le tri" et "Voir les albums".

swipe_screen.dart :

Chargement des m√©dias non tri√©s. Logique des swipes (droite/gauche/haut/bas). Barre de progression.

albums_screen.dart :

Grille des albums. Double-clic pour √©diter le nom. Bouton "Commencer" pour chaque album.

G√©rer la navigation (app_router.dart) :

Utiliser PageView pour le swipe entre √©crans. D√©sactiver le swipe lat√©ral sur swipe_screen.dart.

Tests et Validation :

V√©rifier que :

Les swipes ne buggent pas. Les m√©dias supprim√©s vont dans la corbeille. La restauration fonctionne. Les albums s‚Äôaffichent correctement.

D. Points d‚ÄôAttention pour l‚ÄôIA

Pas de couleurs : Tout doit √™tre en noir (#000000), blanc (#FFFFFF), ou gris (#333333, #808080). Gestes prioritaires :

Le swipe haut doit toujours annuler la derni√®re action (m√™me sur l‚Äô√©cran de swipe d‚Äôun album).

Pas de duplication de fichiers :

Les m√©dias dans les albums sont des liens symboliques (ou chemins r√©f√©renc√©s).

Corbeille :

Les fichiers supprim√©s sont d√©plac√©s, pas effac√©s. Pr√©voir un Worker pour vider la corbeille apr√®s 30 jours.

E. Questions pour l‚ÄôIA

Faut-il ajouter un mode "s√©lection multiple" pour supprimer plusieurs m√©dias d‚Äôun coup ? Comment g√©rer les vid√©os longues (ex: > 1 min) pour √©viter de charger trop de donn√©es ? Veux-tu que je g√©n√®re aussi les ic√¥nes en noir et blanc pour les albums ? Dois-je pr√©voir un syst√®me de logs pour d√©boguer les erreurs de suppression ?

Exemple de Code (Extrait) A. Th√®me Sombre (theme.dart) Copierimport 'package:flutter/material.dart';
final darkTheme = ThemeData( brightness: Brightness.dark, primaryColor: const Color(0xFF000000), scaffoldBackgroundColor: const Color(0xFF000000), textTheme: const TextTheme( headline1: TextStyle(color: Color(0xFFFFFFFF), fontSize: 24, fontWeight: FontWeight.bold), bodyText1: TextStyle(color: Color(0xFFFFFFFF), fontSize: 16), bodyText2: TextStyle(color: Color(0xFF808080), fontSize: 14), ), iconTheme: const IconThemeData(color: Color(0xFFFFFFFF)), buttonTheme: ButtonThemeData( buttonColor: const Color(0xFFFFFFFF), textTheme: ButtonTextTheme.primary, ), ); B. Widget StorageBar (storage_bar.dart) Copierclass StorageBar extends StatelessWidget { final double totalSpace; // en Go final double usedSpace; final double freedSpace;

const StorageBar({ required this.totalSpace, required this.usedSpace, required this.freedSpace, });

@override Widget build(BuildContext context) { return Column( children: [ // Barre 1 : Espace total/utilis√© _buildProgressBar( value: usedSpace / totalSpace, label: '${usedSpace.toStringAsFixed(1)} Go / ${totalSpace.toStringAsFixed(1)} Go', color: Colors.white, ), const SizedBox(height: 8), // Barre 2 : Espace lib√©r√© _buildProgressBar( value: freedSpace / totalSpace, label: '+${freedSpace.toStringAsFixed(1)} Go lib√©r√©s', color: Colors.grey[500]!, ), ], ); }

Widget _buildProgressBar({required double value, required String label, required Color color}) { return Column( crossAxisAlignment: CrossAxisAlignment.start, children: [ Text(label, style: Theme.of(context).textTheme.bodyText2), const SizedBox(height: 4), LinearProgressIndicator( value: value, backgroundColor: const Color(0xFF333333), valueColor: AlwaysStoppedAnimation

Validation et Livrables A. Crit√®res de Validation Crit√®reM√©thode de TestSwipes fonctionnelsTester tous les gestes sur 10 m√©dias.Barres de stockage mises √† jourSimuler la suppression de 1 Go.Albums √©ditablesDouble-cliquer sur un nom d‚Äôalbum.Restauration des m√©diasSwipe haut apr√®s une suppression.Pas de duplication de fichiersV√©rifier le chemin des m√©dias dans les albums. B. Livrables
Code source complet (dossier lib/). Fichier pubspec.yaml avec d√©pendances Kotlin. Documentation :

Comment ajouter un nouvel album (pour la version premium). Comment √©tendre la corbeille √† 1 an.

Capture d‚Äô√©cran des 3 √©crans (pour validation visuelle).

Prochaines √âtapes (Pour Toi, Sacha)
Valider le design UI : Je peux te g√©n√©rer des maquettes Figma en noir et blanc si besoin. Tester le MVP :

V√©rifier que les swipes sont fluides. Confirmer que l‚ÄôUI est bien en noir et blanc.

Planifier les fonctionnalit√©s premium :

Quels avantages veux-tu offrir en priorit√© (cloud ? th√®mes ?) ? et voici le prompt pas structur√© Salut, je vais faire une appli en Flutter d'Art et je veux que toutes les d√©pendances soient en Kotlin. Parce que je suis sur le PC du lyc√©e, je ne peux pas acc√©der aux param√®tres de variables d'environnement. Je ne peux pas activer le mode d√©veloppeur sur l'ordinateur. Donc tout ce que tu le feras, prends √ßa en compte de √ßa. Tu vas prendre mon repo dans lequel il y a d√©j√† un projet de base Flutter et tu auras juste √† √©diter les fichiers que tu auras besoin pour cr√©er mon application. Ce sera une application de tri de photos par swipe. qui va se baser sur le swiping pour nettoyer le t√©l√©phone, pour les photos et les vid√©os. N'oublie pas les vid√©os. On aura trois √©crans, l'√©cran d'accueil, l'√©cran de swipe √† droite de l'√©cran d'accueil qui sera au milieu, et √† gauche on a l'√©cran de... Dans l'√©cran des albums, il y a trois albums. Dans l'√©cran d'accueil, il y a les statistiques, donc l'espace de stockage total sous forme de barre horizontale avec l'espace de stockage consomm√©, donc tout √ßa sous forme de barre horizontale. En dessous, une deuxi√®me barre o√π il y aura l'espace de stockage lib√©r√© ce mois-ci. En dessous on aura le dernier album visit√© et tout en dessous on aura un bouton commencer le tri ou juste au dessus un bouton l√©g√®rement plus petit et d'un contre int√©ress√© pour voir les albums. A droite de cela on aura l'√©cran, quand on cliquera sur commencer le tri on tombera sur l'√©cran de swipe ou dans la barre de t√¢che ou sinon avec les fl√®ches en haut des √©crans il y aura des fl√®ches pour acc√©der √† tous les √©crans. On va aussi √©galement glisser entre les √©crans en juste avec des mouvements lat√©raux du doigt donc en swipant on peut passer d'√©cran. Sur l'√©cran de swipe, on ne peut pas se d√©placer parce qu'on swipe d√©j√†. Sur l'√©cran de swipe, tu swipes √† droite, √ßa garde la photo. Tu swipes √† gauche, √ßa supprime. Tu swipes vers le haut, √ßa restaure la photo qu'on avait juste avant. Tu swipes vers le bas, √ßa te met un menu d√©roulant avec les trois albums. Tu s√©lectionnes l'album, √ßa met la photo dans l'album. On aura une photo qui sera au maximum cadr√©e sur le t√©l√©phone, donc je veux qu'elle prenne un maximum de place avec presque rien comme √©criture. Et juste en haut, on aura la barre de progression de combien on a d√©j√† lib√©r√© en swipant depuis que l'application a √©t√© ouverte. Donc par exemple, si je la ferme dans mon t√©l√©phone, √ßa remettra cette barre √† z√©ro. On aura √©galement l'√©cran avec les albums, avec 3 albums par d√©faut et un bouton plus gris√© qu'on ne pourra pas ajouter parce que ce sera la version payante. √âgalement, sur l'√©cran de l'album, on peut double-cliquer sur un album pour modifier le nom. L'album affichera la derni√®re photo qu'on a mise. Il affichera une photo qu'on choisit en fond d'√©cran, mais par d√©faut il affichera la derni√®re photo qu'on a mise. Et quand on va dans l'album, on peut soit tout en bas, il y a un bouton ¬´ Commencer ¬ª ajout√© √† cet album, on retombe sur un √©cran de swipe et l√† tu swipes √† gauche, √ßa met sur cet album, tu swipes √† droite, √ßa passe, tu swipes vers le haut, √ßa restaure la photo que nous avons montr√©e juste avant. en annulant les changements apport√©s √† cette photo bien s√ªr. Et pareil pour l'√©cran de swipe normal, quand on swipe vers le haut, √ßa annule les changements qu'on a apport√©s sur cette photo en swipant juste avant. Tout √ßa c'est clair, pour lui, fais tout √ßa juste en noir et blanc pour l'instant, en th√®me sombre, apr√®s moi je te montrerai comment faire pour lui. D'accord ?



D√©cisions confirm√©es :

Suppression : Les m√©dias sont d√©plac√©s vers une corbeille (dans Firebase Storage) avec possibilit√© de restauration via swipe haut.
Base de donn√©es : Firestore (remplace SQLite/Floor) avec synchronisation en temps r√©el et cache local activ√©.
Albums : Utilisation de r√©f√©rences dans Firestore (pas de duplication de fichiers).
Stockage : Firebase Storage pour les m√©dias et la corbeille, avec r√®gles de s√©curit√© pour limiter l‚Äôacc√®s aux fichiers de l‚Äôutilisateur.
Authentification : Firebase Auth (email/mot de passe + Google Sign-In).
1. Initialisation du Projet Flutter
Cr√©er un nouveau projet Flutter avec support Android.
Configurer pubspec.yaml :
yaml
 Copier
dependencies:
  flutter:
    sdk: flutter
  firebase_core: ^2.15.0
  firebase_auth: ^4.7.0
  cloud_firestore: ^4.8.0
  firebase_storage: ^11.2.0
  photo_manager: ^2.6.0
  video_thumbnail: ^0.5.3
  cached_network_image: ^3.3.0
  permission_handler: ^10.4.0
  shared_preferences: ^2.2.1
  provider: ^6.0.5
  flutter_bloc: ^8.1.3  # Pour la gestion d'√©tat robuste
  logger: ^2.0.2        # Pour les logs d√©taill√©s
Ajouter les permissions Android dans AndroidManifest.xml :
xml
 Copier
<uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" />
<uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
<uses-permission android:name="android.permission.MANAGE_EXTERNAL_STORAGE" />
<!-- Pour Android 13+ -->
<uses-permission android:name="android.permission.READ_MEDIA_IMAGES" />
<uses-permission android:name="android.permission.READ_MEDIA_VIDEO" />
Configurer le SDK minimum Android √† 21 et target SDK √† 33.
D√©finir le th√®me sombre global avec palette noir et blanc stricte.
2. Syst√®me de Th√®me et Constantes
Cr√©er le fichier theme.dart avec ThemeData en mode sombre.
Couleurs :
Fond : #000000
Texte : #FFFFFF
Gris fonc√© : #333333
Gris clair : #808080
Polices : Roboto (bold 24px, regular 16px, light 14px).
Constantes d‚Äôespacement : marges 16px, padding boutons 12px.
Albums par d√©faut : Favoris, Voyages, Famille.
3. Mod√®les de Donn√©es et Firestore
Mod√®le Album :
dart
 Copier
class Album {
  final String id;          // ID Firestore
  final String name;
  final String? coverPath;  // Chemin dans Firebase Storage
  final bool isPremium;
  final DateTime createdAt;
  final String userId;     // R√©f√©rence √† l'utilisateur (Firebase Auth UID)
}
Mod√®le Media :
dart
 Copier
enum MediaType { photo, video }

class Media {
  final String id;          // ID Firestore
  final String originalPath; // Chemin dans Firebase Storage
  final MediaType type;
  final String? albumId;   // R√©f√©rence √† un Album (nullable)
  final DateTime? deletedAt;
  final int size;          // Taille en octets
  final String userId;     // R√©f√©rence √† l'utilisateur
}
Configuration Firestore :
Activer le cache persistant pour le mode hors ligne.
R√®gles de s√©curit√© :
javascript
 Copier
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
  }
}
Collections :
users/{userId}/albums
users/{userId}/media
users/{userId}/trash (pour les m√©dias supprim√©s)
4. Services de Gestion des Fichiers (avec Firebase Storage)
Cr√©er FileService :
moveToTrash(Media media) :
D√©placer le fichier vers gs://[BUCKET]/users/${userId}/trash/${media.id} dans Firebase Storage.
Mettre √† jour deletedAt dans Firestore.
Gestion des erreurs :
V√©rifier la connexion internet avant l‚Äôop√©ration.
Si √©chec, stocker l‚Äôaction en local (via SharedPreferences) et synchroniser plus tard.
restoreFromTrash(Media media) :
Restaurer le fichier depuis la corbeille vers son emplacement d‚Äôorigine.
Mettre √† jour deletedAt √† null dans Firestore.
deleteDefinitively(Media media) :
Supprimer physiquement le fichier de Firebase Storage.
Supprimer l‚Äôentr√©e dans Firestore.
Gestion des erreurs :
FirebaseException : Afficher un SnackBar avec un message clair et proposer une r√©essayer.
Fichier introuvable : Marquer le m√©dia comme "corrompu" dans Firestore et passer au suivant.
5. Service de Gestion du Stockage
Cr√©er StorageService :
getTotalSpace() : Utiliser path_provider pour l‚Äôespace local + Firebase Storage pour l‚Äôespace cloud.
getUsedSpace() : Calculer la somme des tailles des m√©dias dans Firestore.
getFreedSpaceThisMonth() : Stocker dans SharedPreferences et synchroniser avec Firestore.
getCurrentSessionFreed() : Variable en m√©moire, sauvegard√©e p√©riodiquement.
Formater les tailles en Go/Mo avec 1 d√©cimale.
6. Service de Gestion des M√©dias
Cr√©er MediaService :
Utiliser photo_manager pour lister les m√©dias locaux.
Filtrer les dossiers syst√®me (.thumbnails, .trash, etc.).
Trier par date d√©croissante.
Charger par lots de 20 m√©dias pour optimiser la m√©moire.
G√©n√©rer les miniatures avec video_thumbnail et les uploader dans Firebase Storage (dossier thumbnails).
Cache : Utiliser cached_network_image pour les miniatures, avec une limite de 100 Mo.
7. Widget StorageBar
Deux LinearProgressIndicator superpos√©s :
Barre sup√©rieure : Espace utilis√© (X Go / Y Go).
Barre inf√©rieure : Espace lib√©r√© ce mois (+X Go lib√©r√©s).
Animations : duration: 0.5s.
Couleurs : Fond #333333, barres #FFFFFF et #808080.
8. Widget AlbumCard
Carte 150x150px avec bordure #333333.
Miniature : Derni√®re photo de l‚Äôalbum (ou ic√¥ne par d√©faut).
Nom de l‚Äôalbum : √âditable via double-clic, sauvegard√© dans Firestore au onSubmitted.
Fallback : Si l‚Äôalbum est vide, afficher une ic√¥ne par d√©faut (‚ô•, ‚úà, üè†).
9. Widget MediaCard
Affichage plein √©cran (90% hauteur/largeur).
Indicateurs de geste : ‚Üê (supprimer), ‚Üí (garder), ‚Üë (annuler), ‚Üì (albums).
Gestion des erreurs :
Si le m√©dia ne charge pas, afficher une ic√¥ne ‚ö†Ô∏è et un bouton "R√©essayer".
Utiliser CircularProgressIndicator pendant le chargement.
10. Widget SwipeMenu
Overlay modal avec 3 albums (ic√¥nes ‚ô•, ‚úà, üè†).
Animation : SlideTransition depuis le bas (duration: 0.3s).
Bouton "Annuler" en gris en haut √† droite.
11. √âcran d‚ÄôAccueil (HomeScreen)
StorageBar en haut.
Section "Dernier album visit√©" : R√©cup√©r√© depuis SharedPreferences.
Boutons :
"Commencer le tri" ‚Üí SwipeScreen.
"Voir les albums" ‚Üí AlbumsScreen.
Rafra√Æchir les stats avec FutureBuilder √† chaque ouverture.
12. √âcran de Swipe Principal (SwipeScreen)
Stack : M√©dia + indicateurs + barre de progression.
Gestion des swipes :
Droite : Passer au m√©dia suivant.
Gauche : D√©placer vers la corbeille (Firebase Storage + Firestore).
Haut : Annuler la derni√®re action (via pile d‚Äôhistorique).
Bas : Afficher SwipeMenu.
Pile d‚Äôhistorique : 10 actions max, stock√©e en m√©moire et synchronis√©e avec Firestore.
13. √âcran des Albums (AlbumsScreen)
GridView avec 2 colonnes.
Albums par d√©faut : Charg√©s depuis Firestore.
Bouton "+" : Gris√© si user_is_premium == false (limite √† 3 albums).
Tooltip : "Disponible en version Premium".
14. √âcran de Swipe pour Album (AlbumSwipeScreen)
M√™me structure que SwipeScreen, mais :
Swipe gauche : Assigner le m√©dia √† l‚Äôalbum (mettre √† jour albumId dans Firestore).
Compteur : "X photos ajout√©es" au lieu de l‚Äôespace lib√©r√©.
15. Navigation Entre √âcrans
PageView avec 3 pages : AlbumsScreen, HomeScreen, SwipeScreen.
D√©sactiver PageView sur SwipeScreen et AlbumSwipeScreen.
Sauvegarder le dernier album visit√© dans SharedPreferences.
16. Gestion de l‚ÄôHistorique et Restauration
Classe HistoryAction :
dart
 Copier
class HistoryAction {
  final String actionType; // 'delete', 'assign', 'unassign'
  final String mediaId;
  final String? previousAlbumId;
  final DateTime timestamp;
}
Pile de 10 actions max, stock√©e en m√©moire et synchronis√©e avec Firestore.
Swipe haut : D√©piler la derni√®re action et effectuer l‚Äôop√©ration inverse.
17. Optimisations de Performance
Lazy loading : Pr√©-charger 3 m√©dias en avance.
AutomaticKeepAliveClientMixin pour les pages du PageView.
Compression : Utiliser flutter_image_compress pour les images > 5 Mo.
compute() pour les op√©rations lourdes (ex : g√©n√©ration de miniatures).
18. Gestion des Permissions Android
Demander les permissions au d√©marrage avec permission_handler.
Android 13+ : READ_MEDIA_IMAGES et READ_MEDIA_VIDEO.
Android 10-12 : READ_EXTERNAL_STORAGE et WRITE_EXTERNAL_STORAGE.
Dialogue explicatif si refus, redirection vers les param√®tres si n√©cessaire.
19. Pr√©paration Mon√©tisation
user_is_premium dans SharedPreferences (d√©faut : false).
Limiter √† 3 albums si non premium.
Bouton "+" gris√© et d√©sactiv√© si limite atteinte.
TODO : Pr√©parer l‚Äô√©cran PremiumScreen et les int√©grations de paiement (Stripe/Firebase In-App Purchases).
20. Animations et Feedback Visuel
Transitions : AnimatedSwitcher (300ms).
Swipe gauche/droite : Transform.translate + FadeTransition.
Restauration : Animation de scale (0.8 ‚Üí 1.0).
Effet ripple sur les boutons.
21. Gestion des Erreurs et Edge Cases (Strat√©gie Renforc√©e)
A. Principes G√©n√©raux
Approche "Defensive Programming" :

Toujours valider les entr√©es/sorties (ex : mediaId existe dans Firestore avant toute op√©ration).
Utiliser des assertions et des logs d√©taill√©s (logger package).
Ne jamais planter : Toujours afficher un message clair et proposer une action (ex : "R√©essayer", "Ignorer").
Gestion des Exceptions :

Centraliser avec un ErrorHandler global :
dart
 Copier
class ErrorHandler {
  static void handleError(dynamic error, StackTrace stackTrace) {
    Logger().e('Erreur captur√©e', error: error, stackTrace: stackTrace);
    // Afficher un SnackBar ou rediriger vers un √©cran d'erreur
  }
}
Types d‚Äôerreurs √† g√©rer :
FirebaseException (ex : pas de connexion internet).
PlatformException (ex : permission refus√©e).
FileSystemException (ex : fichier introuvable).
StateError (ex : pile d‚Äôhistorique vide).
Logs et Debugging :

Logger : Sauvegarder les logs localement et les envoyer √† Firebase Crashlytics.
Identifiants uniques pour les erreurs (ex : ERROR_001: Permission refus√©e).
B. Erreurs par Module

Module
Erreurs Possibles
Solutions
Firestore
Connexion perdue, requ√™te trop lente
Utiliser le cache local, r√©essayer avec exponential backoff.
Firebase Storage
Fichier introuvable, quota d√©pass√©
Marquer le m√©dia comme "corrompu", afficher un SnackBar.
Permissions
Refus de l‚Äôutilisateur
Rediriger vers les param√®tres, afficher un √©cran "Mode limit√©".
M√©dias
Fichier corrompu, miniature non g√©n√©r√©e
Afficher une ic√¥ne par d√©faut, passer au m√©dia suivant.
UI/UX
Geste ambigu, √©tat incoh√©rent
D√©sactiver les boutons si n√©cessaire, ignorer les swipes diagonaux.
C. Exemple de Code Robuste
dart
 Copier
Future<void> moveToTrash(Media media) async {
  try {
    // 1. V√©rifier la connexion internet
    final hasConnection = await _connectivity.checkConnectivity();
    if (hasConnection == ConnectivityResult.none) {
      throw const NoInternetError();
    }

    // 2. D√©placer le fichier vers Firebase Storage
    final trashRef = FirebaseStorage.instance
        .ref()
        .child('users/${media.userId}/trash/${media.id}');
    await trashRef.putFile(File(media.originalPath));

    // 3. Mettre √† jour Firestore
    await FirebaseFirestore.instance
        .collection('users/${media.userId}/media')
        .doc(media.id)
        .update({'deletedAt': FieldValue.serverTimestamp()});

    // 4. Mettre √† jour les stats
    _storageService.incrementFreedSpace(media.size);
  } on FirebaseException catch (e) {
    ErrorHandler.handleError(e, StackTrace.current);
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(content: Text('Erreur Firebase: ${e.message}')),
    );
    rethrow; // Permet au caller de g√©rer l'erreur si n√©cessaire
  } on NoInternetError {
    // Sauvegarder l'action pour synchronisation ult√©rieure
    await _localQueue.addAction('moveToTrash', media.toJson());
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(content: Text('Action sauvegard√©e. Synchronisation d√®s que possible.')),
    );
  } catch (e) {
    ErrorHandler.handleError(e, StackTrace.current);
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(content: Text('Une erreur est survenue (Code: ERROR_002)')),
    );
  }
}
22. Tests et Validation
Tests Unitaires :
Couvrir 100% des cas d‚Äôerreur dans FileService, MediaService.
Utiliser mockito pour simuler des sc√©narios (ex : pas de connexion, fichier introuvable).
Tests d‚ÄôInt√©gration :
Tester les flux complets (ex : swipe gauche ‚Üí suppression ‚Üí restauration).
V√©rifier la coh√©rence de Firestore apr√®s chaque action.
Tests Utilisateurs :
Sc√©narios : suppression de 100 photos, passage en arri√®re-plan, changement de permissions.
23. Monitoring et Am√©lioration Continue
Firebase Crashlytics : Int√©grer pour suivre les plantages.
Firebase Analytics : Suivre les erreurs fr√©quentes et les actions utilisateur.
Mises √† jour :
Pr√©voir un syst√®me de hotfix (ex : correction via Firestore Remote Config).
Utiliser package_info_plus pour forcer les mises √† jour critiques.
24. Checklist Pr√©-Livraison

Cat√©gorie
V√©rifications
Firebase
‚úÖ R√®gles de s√©curit√© configur√©es, cache activ√©, quotas v√©rifi√©s.
Stockage
‚úÖ Permissions g√©r√©es, fallbacks pour les fichiers introuvables.
UI/UX
‚úÖ Feedback clair, gestes pr√©cis, √©tats coh√©rents.
Tests
‚úÖ 100% des cas d‚Äôerreur couverts, tests utilisateurs pass√©s.
Monitoring
‚úÖ Crashlytics et Analytics configur√©s, logs sauvegard√©s.
